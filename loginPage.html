<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>ورود به سیستم</title>
  <style>
    body {
      background: linear-gradient(to right, #141e30, #243b55);
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .code-box {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 10px;
      font-size: 24px;
      margin-bottom: 20px;
    }
    .note {
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="code-box" id="deviceCode">در حال تولید کد...</div>
  <div class="note">این کد را برای مدیر ارسال کنید تا دسترسی دریافت کنید.</div>

  <script>
    function getDeviceCode() {
      const deviceId = btoa(navigator.userAgent + navigator.platform).slice(0, 8).toUpperCase();
      return deviceId;
    }

    const code = getDeviceCode();
    document.getElementById("deviceCode").innerText = code;

    // ذخیره در localStorage
    localStorage.setItem("deviceCode", code);

    // بررسی مجاز بودن دستگاه
    fetch("auth.js")
      .then((r) => r.text())
      .then((t) => {
        const allowedCodes = eval(t.match(/const allowedCodes = \[(.*?)\]/s)?.[0] || "[]");
        if (allowedCodes.includes(code)) {
          window.location.href = "mainPage.html";
        }
      });
  </script>
</body>
</html>
